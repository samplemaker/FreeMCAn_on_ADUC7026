if { [info exists CHIPNAME] } {
   set  _CHIPNAME $CHIPNAME
} else {
   set  _CHIPNAME aduc702x
}

if { [info exists ENDIAN] } {
   set  _ENDIAN $ENDIAN
} else {
  # This config file was defaulting to big endian..
   set  _ENDIAN little
}

if { [info exists CPUTAPID] } {
   set  _CPUTAPID $CPUTAPID
} else {
   set  _CPUTAPID 0x3f0f0f0f
}

#should be 1/6 coreclock
jtag_rclk 7000
jtag_khz 7000

jtag_nsrst_delay 200
jtag_ntrst_delay 200

reset_config trst_and_srst srst_pulls_trst

## JTAG scan chain
#format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID

##
## Target configuration
##
set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME

# allocate the entire SRAM as working area
$_TARGETNAME configure -work-area-phys 0x10000 -work-area-size 0x2000

## flash configuration
# only target number is needed
set _FLASHNAME $_CHIPNAME.flash
flash bank $_FLASHNAME aduc702x 0 0 0 0 $_TARGETNAME


proc flash_load {file} {
     soft_reset_halt
     poll off
     flash write_image erase $file 0x00080000 bin
     poll on
}

proc flash_erase {} {
     soft_reset_halt
     poll off
     flash erase_sector 0 0 123
     sleep 500
     poll on
}

proc flash_dump {} {
     #ADuC7019/ADuC702x Silicon Anomaly List:
     #Access to Flash Address 0x0008F7FF Causes a Data Abort [er022]
     dump_image flash.dump 0x00080000  0x0000f7fe
}
